<% layout('layout') %>

<div class="row center_div_channel">
    <% for(let i = 0; i<locals.tags.length; i++){ %>

    <!-- Button trigger modal -->
    <div class="tag">
        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modal<%= locals.tags[i].id_tag %>">
            <%= locals.tags[i].libelle_tag %>
        </button>
    </div>


    <!-- Modal -->
    <div class="modal fade" id="modal<%= locals.tags[i].id_tag %>" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel"><%= locals.tags[i].libelle_tag %></h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    ...
                </div>
                <div class="modal-footer">
                    <button id="deleteTag" type="button" class="btn btn-secondary" onclick="deleteTag(<%= locals.tags[i].id_tag %>)">Delete</button>
                    <button type="button" class="btn btn-primary">Save changes</button>
                </div>
            </div>
        </div>
    </div>


    <% } %>

    <script>
        function deleteTag(idTag){
            var url = "/tag/delete/";
            var xhr = new XMLHttpRequest();
            xhr.open("DELETE", url + idTag, true);

            xhr.onreadystatechange = function() { // listen for state changes
                if (xhr.readyState == 4 && xhr.status == 200) { // when completed we can move away
                    console.log('redirect');
                    window.location.replace('/tags');
                }
            }

            xhr.send(null);


        }

    </script>

</div>
